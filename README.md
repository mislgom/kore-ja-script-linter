# 🎬 대본 검수 시스템 (Script Review Pro vNext)

유튜브 채널 및 영상 콘텐츠 제작을 위한 **AI 기반 완전 자동화** 대본 검수 + 오류 수정 + 다운로드 도구

---

## 📋 프로젝트 개요

| 항목 | 내용 |
|------|------|
| **프로젝트명** | 대본 검수 시스템 (Script Review Pro) |
| **버전** | vNext (Issues 관리 + Vrew 다운로드) |
| **목적** | 대본 검수 → 오류 추출/표시 → 즉시 수정 → 다운로드(Vrew) |
| **기술 스택** | HTML5, Tailwind CSS, Vanilla JavaScript, **Gemini Flash 2.5 API** |

---

## ✅ vNext 구현 기능 (Phase 1 완료)

### 🔍 1-1. 오류 자동 추출 (issues[] 생성)
검수 후 오류 문장/구간을 자동 추출하여 `issues[]` 생성
- **필수 필드**: id, category, ruleId, severity, confidence
- **위치 정보**: startIndex, endIndex, snippet
- **피드백**: message, reason, suggestion
- **액션**: editThis, ignoreThis

### 🏷️ 1-2. 오류 유형별 표시/필터 UI (카테고리 4종)

| 카테고리 | 설명 | 색상 |
|----------|------|------|
| **BG** | 배경 오류 (한국 배경 키워드 부족/충돌) | 🔵 Blue |
| **CHAR** | 인물 설정 일관성 (이름/나이/특성 불일치) | 🟣 Purple |
| **REL** | 인물 관계 일관성 (관계어 변경) | 🩷 Pink |
| **FLOW** | 전개/흐름 오류 (부자연/급전개/인과 단절) | 🟠 Orange |
| **SYS** | 시스템 오류 (파싱 실패 등) | ⚫ Gray |

**UI 기능:**
- ✅ 오류 리스트 패널 + 카테고리 필터 (멀티 토글)
- ✅ Severity 뱃지 (HIGH/MED/LOW) + Confidence 표시
- ✅ 원문 하이라이트 (startIndex~endIndex)
- ✅ 정렬: 문서 내 발생 순 / 심각도 높은 순
- ✅ 카드 액션: `이 오류만 수정`, `무시/예외처리`

### ✏️ 1-3. 인라인 편집 + 부분 재검사
- ✅ 오류 카드 클릭 → 해당 구간 인라인 편집 모달
- ✅ 저장 시 관련 규칙만 부분 재검사
- ✅ 전체 재검사 옵션

### 📥 1-4. 다운로드 기능 (2종)

| 다운로드 | 파일명 | 설명 |
|----------|--------|------|
| **수정본 TXT** | `script_reviewed_YYYYMMDD.txt` | UTF-8 인코딩 |
| **Vrew용 TXT** | `script_vrew_YYYYMMDD.txt` | 클립 자동 줄맞춤 |

**Vrew 옵션:**
- A) 1줄=1클립 (기존 줄바꿈 유지)
- B) 문장 단위 + 최대 글자수 자동 개행 (18~24자)

---

## 🤖 Phase 2: FLOW 하이브리드 판정 (Gemini 2.5)

### 원칙: "룰로 후보 구간 추출 → Gemini로 확정"

**1차 룰 (후보 구간 candidateSegments 생성):**
- 시간 점프 감지 (N년 후, 다음 날 등)
- 장소 급변 감지
- 감정 급변 감지 (긍정↔부정 혼재)
- 사건 급변 신호

**2차 Gemini 2.5 호출 (후보만):**
```json
{
    "isIssue": true/false,
    "issueType": "부자연전개/인과누락/연결부자연/없음",
    "severity": "HIGH/MED/LOW",
    "confidence": "HIGH/MID/LOW",
    "reason": "판정 근거",
    "suggestion": "최소 수정 제안"
}
```

---

## ⚡ Phase 3: 10만자+ 성능 최적화

### 구현된 최적화 기능:

| 기능 | 설명 |
|------|------|
| **ChunkProcessor** | 대용량 텍스트 청크 분할 처리 |
| **OptimizedKeywordMatcher** | 첫 글자 기반 맵 + 정규식 최적화 |
| **ProgressIndicator** | 진행률 표시 UI |
| **SafeExecutor** | try/catch 래퍼 + SYS 오류 기록 |
| **MemoryManager** | 메모리 정리 유틸리티 |

### 성능 보장:
- ✅ 10만자+ 입력에서 UI 프리징 없음
- ✅ 로딩/진행률 표시
- ✅ 청크 간 지연으로 브라우저 응답성 유지

---

## 🛡️ Phase 4: 실패 안전 처리

- ✅ 파싱 실패 시 앱 중단 금지 (try/catch + fallback)
- ✅ "분석 불가 구간"은 `SYS` 카테고리로 기록 후 계속 진행
- ✅ 정규식 무한 루프 방지 (maxIterations)

---

## 📁 파일 구조

```
/
├── index.html                    # 메인 페이지
├── css/
│   └── style.css                 # 스타일 (다크모드 + Issues UI)
├── js/
│   ├── performance-utils.js      # ⭐ 성능 최적화 유틸리티 (NEW!)
│   ├── gemini-api.js             # Gemini API + FLOW 하이브리드
│   ├── review-korea-senior.js    # 한국 시니어 낭독 검수 모듈
│   ├── issues-manager.js         # ⭐ Issues 관리 시스템 (NEW!)
│   ├── issues-ui.js              # ⭐ Issues UI 컨트롤러 (NEW!)
│   └── main.js                   # 메인 JavaScript
└── README.md                     # 프로젝트 문서
```

---

## 🖥️ 검수 프로세스 플로우

```
┌─────────────────────────────────────────────────────────────────┐
│  1️⃣ 대본 입력 (10만자+ 지원)                                    │
│     ↓                                                           │
│  [전체 자동 검수 시작] 버튼 클릭                                 │
│     ↓                                                           │
├─────────────────────────────────────────────────────────────────┤
│  2️⃣ 규칙 기반 검수 (6개 항목)                                   │
│  [한국배경 90점] [인물 100점] [관계 100점]                       │
│  [흐름 85점] [페이싱 80점] [재미 65점]                           │
│     ↓                                                           │
├─────────────────────────────────────────────────────────────────┤
│  3️⃣ Issues 자동 추출                                            │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 🔵 BG-0001 | HIGH | 한국 배경 키워드 부족              │   │
│  │    └ [이 오류 수정] [무시]                              │   │
│  │ 🟣 CHAR-0002 | MED | 나이 불일치 (32세 → 35세)         │   │
│  │    └ [이 오류 수정] [무시]                              │   │
│  │ 🟠 FLOW-0003 | LOW | 씬 전환이 급작스러움              │   │
│  │    └ [이 오류 수정] [무시]                              │   │
│  └─────────────────────────────────────────────────────────┘   │
│     ↓                                                           │
├─────────────────────────────────────────────────────────────────┤
│  4️⃣ 인라인 편집                                                 │
│  [오류 카드 클릭] → 편집 모달 → [저장] → 부분 재검사            │
│     ↓                                                           │
├─────────────────────────────────────────────────────────────────┤
│  5️⃣ 다운로드                                                    │
│  [수정본 다운로드] → script_reviewed_20250129.txt               │
│  [Vrew용 다운로드] → script_vrew_20250129.txt (옵션 선택)       │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🎯 사용 방법

### 기본 사용법
1. **대본 입력**: 텍스트 영역에 대본 붙여넣기 (10만자 이상 가능)
2. **검수 시작**: "전체 자동 검수 시작" 버튼 클릭
3. **등장인물 확인**: 추출된 인물 정보 검토
4. **검수 진행**: "확인 완료, 검수 시작" 버튼 클릭
5. **오류 확인**: Issues 패널에서 발견된 오류 확인
6. **오류 수정**: 오류 카드에서 "이 오류 수정" 클릭
7. **다운로드**: 수정 완료 후 TXT 다운로드

### 권장 대본 형식
```
[씬 1. 서울 강남 아파트 / 낮]

나레이션:
상황 설명...

현숙(엄마, 55세, 자상한 성격):
대사 내용...

창현(아들, 32세, 회사원):
대사 내용...
```

---

## 📊 출력 데이터 스키마

### analysisResult
```javascript
{
    characters: { /* 인물 정보 */ },
    relationships: [ /* 관계 정보 */ ],
    stats: { /* 대본 통계 */ }
}
```

### issues[]
```javascript
{
    id: "CHAR-0001",
    category: "CHAR",  // BG/CHAR/REL/FLOW/SYS
    ruleId: "CHAR-INCONSIST-001",
    severity: "HIGH",  // HIGH/MED/LOW
    confidence: "HIGH", // HIGH/MID/LOW
    startIndex: 1234,
    endIndex: 1456,
    snippet: "현숙(엄마, 55세) ... 현숙(엄마, 58세)",
    message: "인물 '현숙'의 나이가 일관되지 않습니다.",
    reason: "55세 → 58세로 변경됨",
    suggestion: "나이를 일관되게 수정하세요."
}
```

### edits[]
```javascript
{
    id: "EDIT-1706500000000",
    issueId: "CHAR-0001",
    before: "현숙(엄마, 58세)",
    after: "현숙(엄마, 55세)",
    timestamp: 1706500000000,
    userAction: "edit"
}
```

---

## 🚧 Phase 2+ 로드맵 (미구현)

### Phase 2 (운영/생산성 강화)
- [ ] Undo/Redo
- [ ] 변경 비교 (Diff)
- [ ] 일괄 수정 (배치 수정)
- [ ] 저장/불러오기 (LocalStorage 또는 파일)
- [ ] 검수 이력 (최근 N개)
- [ ] 규칙/키워드 DB 관리 화면

### Phase 3 (확장)
- [ ] 조선 야담 검수 모듈
- [ ] 일본 시니어 낭독 모듈
- [ ] 전세계 뉴스 모듈

---

## 📝 변경 이력

| 날짜 | 버전 | 내용 |
|------|------|------|
| 2025-01-29 | v1.0 | 기본 프레임워크, 4개 탭 시스템 |
| 2025-01-29 | v1.1 | 한국 시니어 낭독 검수 (1~3번 자동) |
| 2025-01-29 | v2.0 | 완전 자동화 - 6개 항목 전체 자동 분석 |
| 2025-01-29 | v2.1 | 다크모드, 2단계 검수 프로세스 |
| 2025-01-29 | v2.2 | Gemini Flash 2.5 API 연동 |
| 2025-01-29 | **vNext** | ⭐ Issues 관리, 인라인 편집, Vrew 다운로드, 10만자+ 최적화 |

---

## ✅ 수락 기준 (완료 조건) 체크리스트

- [x] 오류 발생 시 `issues[]` 생성 + UI 카테고리별 표시
- [x] 원문 하이라이트 (startIndex~endIndex)
- [x] 오류 카드에서 "이 오류만 수정" 가능
- [x] 저장 후 부분 재검사 + 점수/합불 갱신
- [x] 다운로드 2종: 수정본 TXT / Vrew용 TXT
- [x] 10만자+ 입력에서도 UI 프리징 없이 완료
- [x] 파싱/정규식 실패에도 앱 중단 없이 SYS 오류로 기록

---

*© 2025 대본 검수 시스템. Built with AI for content creators.*
