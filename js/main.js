// ========== 프롬프트 생성 ==========
function generatePrompt(stage, script) {
    if (stage === 'stage1') {
        return '당신은 한국 시니어 낭독용 대본의 **설정 일관성 검수** 전문가입니다.\n\n' +
            '## 분석 대상 대본:\n' + script + '\n\n' +
            '## 🔍 1차 분석 항목\n\n' +
            '### 1. 국가 배경 확인\n' +
            '- 도시명, 지명, 화폐 단위, 문화적 요소가 해당 국가에 맞는지\n\n' +
            '### 2. 시대 배경 분석\n' +
            '- 해당 시대에 맞지 않는 사물, 기술, 문화, 언어 사용 시 오류\n\n' +
            '### 3. 등장인물 설정 분석\n' +
            '- 이름, 나이, 외형, 성격, 직업이 처음부터 끝까지 동일한지\n\n' +
            '### 4. 등장인물 관계 분석\n' +
            '- 인물 간 관계가 처음부터 끝까지 일관되게 유지되는지\n\n' +
            '## 출력 형식 (반드시 JSON으로만 응답):\n' +
            '```json\n' +
            '{\n' +
            '  "analysis": "번호\\t오류 유형\\t오류 대본\\t변경 대본\\t검수 포인트\\n1\\t시대착오\\t오류 문장\\t수정 문장\\t설명",\n' +
            '  "revised": "모든 오류를 수정한 전체 대본"\n' +
            '}\n' +
            '```\n\n' +
            '## 중요 규칙:\n' +
            '1. 오류가 없으면 analysis에 "오류 없음" 기재\n' +
            '2. revised에는 수정된 완전한 대본 작성\n' +
            '3. 반드시 완전한 JSON으로 응답\n' +
            '4. JSON 외 다른 텍스트 금지';
    } else {
        return '당신은 한국 시니어 낭독용 대본의 **스토리 흐름 및 품질 검수** 전문가입니다.\n\n' +
            '## 1차 검수 완료된 대본:\n' + script + '\n\n' +
            '## 🔍 2차 분석 항목\n\n' +
            '### 1. 시간 흐름 왜곡\n' +
            '- 아침/점심/저녁, 계절, 시간 순서가 논리적인지\n\n' +
            '### 2. 장소 흐름 왜곡\n' +
            '- 장소 이동이 논리적인지\n\n' +
            '### 3. 시니어 적합성\n' +
            '- 50-70대 청취자에게 적합한 콘텐츠인지\n\n' +
            '### 4. 1차 검수 재확인\n' +
            '- 놓친 오류가 없는지 확인\n\n' +
            '## 출력 형식 (반드시 JSON으로만 응답):\n' +
            '```json\n' +
            '{\n' +
            '  "analysis": "번호\\t오류 유형\\t오류 대본\\t변경 대본\\t검수 포인트\\n1\\t시간 왜곡\\t오류 문장\\t수정 문장\\t설명",\n' +
            '  "revised": "최종 수정된 완전한 대본",\n' +
            '  "scores": {\n' +
            '    "fun": 85,\n' +
            '    "flow": 90,\n' +
            '    "senior": 88,\n' +
            '    "retention": 82\n' +
            '  }\n' +
            '}\n' +
            '```\n\n' +
            '## ⚠️ 점수 평가 기준 (0-100점) - 중요!\n' +
            '**반드시 "revised"에 작성된 최종 수정 완료된 대본을 기준으로 점수를 평가하세요.**\n\n' +
            '- **fun (재미요소)**: 최종 대본의 흥미도, 몰입감, 감동 요소\n' +
            '- **flow (대본 흐름)**: 최종 대본의 시간/장소/상황 전개의 자연스러움\n' +
            '- **senior (시니어 적합성)**: 최종 대본이 50-70대 청취자에게 적합한 정도\n' +
            '- **retention (시청 이탈율 방지)**: 최종 대본을 끝까지 듣고 싶은 정도 (높을수록 좋음)\n\n' +
            '## 중요 규칙:\n' +
            '1. scores는 반드시 **revised(최종 수정 대본)를 기준**으로 0-100 사이의 정수로 평가\n' +
            '2. revised에는 최종 완성된 대본 작성\n' +
            '3. 반드시 완전한 JSON으로 응답\n' +
            '4. JSON 외 다른 텍스트 금지';
    }
}
